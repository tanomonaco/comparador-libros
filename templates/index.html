<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparador de Libros</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; }
        input { width: 70%; padding: 10px; font-size: 16px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
        #resultados { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
        .libro { border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px; }
    </style>
</head>
<body>

    <h1>ðŸ“š Mi Comparador de Libros</h1>
    <p>Ingresa el ISBN de un libro para encontrar el mejor precio.</p>

    <div>
        <input type="text" id="isbn-input" placeholder="Ej: 978-0747532743">
        <button id="buscar-btn">Buscar</button>
    </div>

    <div id="resultados">
        </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const botonBuscar = document.getElementById('buscar-btn');
            const inputIsbn = document.getElementById('isbn-input');
            const divResultados = document.getElementById('resultados');

            botonBuscar.addEventListener('click', () => {
                const isbn = inputIsbn.value;

                if (!isbn) {
                    alert('Por favor, ingresa un ISBN.');
                    return;
                }

                divResultados.innerHTML = '<p>Buscando...</p>';

                fetch(`/api/search/${isbn}`)
                    .then(response => response.json())
                    .then(data => {
                        divResultados.innerHTML = ''; 

                        const tituloHtml = `<h2>${data.titulo}</h2>`;
                        const autorHtml = `<p><em>por ${data.autor}</em></p>`;

                        let preciosHtml = '';
                        data.precios.forEach(tienda => {
                            preciosHtml += `
                                <div class="libro">
                                    <strong>Tienda:</strong> ${tienda.tienda}<br>
                                    <strong>Precio:</strong> ${tienda.precio} ${tienda.moneda}<br>
                                    <a href="${tienda.link}" target="_blank">Ver en tienda</a>
                                </div>
                            `;
                        });

                        divResultados.innerHTML = tituloHtml + autorHtml + preciosHtml;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        divResultados.innerHTML = '<p>Hubo un error al realizar la bÃºsqueda.</p>';
                    });
            });
        });
    </script>

</body>
</html>